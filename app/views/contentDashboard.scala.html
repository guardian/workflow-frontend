@(items: List[WorkflowContent])
@import helper._
@import Formatting._
@import models.WorkflowStatus
@main("Content Dashboard") {
   <div class="table">
       <table class="table table-striped">
           <tr>
               <th>Working Title / Path</th>
               <th>Contributors</th>
               <th>Status</th>
               <th>Desk</th>
               <th>Scheduled Launch</th>
               <th>Author</th>
               <th>Edited</th>
               <th>Subbed</th>
               <th>Published</th>
               <th>Last Modified</th>
               <th>By</th>
               <th>What Changed</th>
           </tr>
           @for(content <- items) {
           <tr data-content=@content.id>
               <td>
                   @for(title <- content.workingTitle) {
                   @title
                   }
                   @for(path <- content.path) {
                   @path
                   }
               </td>
               <td>@content.contributors.map(_.name).mkString(", ")</td>
               <td>
                   <a href="/content?filterBy=status&filterValue=@content.status">@content.status</a>
               </td>
               <td data-field="desk">
                   <a href="/content?filterBy=desk&filterValue=@content.desk">@content.desk</a>
               </td>
               <td data-field="launch">
                   <div contenteditable="true">@content.scheduledLaunch.map(displayDate(_))</div>
               </td>
               <td data-value="author" data-field="status">
                   <div contenteditable="true">
                       @for(user <- content.stateHistory.get(WorkflowStatus.Author)) {
                            @user
                       }
                   </div>
               </td>
               <td data-value="edited" data-field="status">
                   <div contenteditable="true">
                       @for(user <- content.stateHistory.get(WorkflowStatus.Edited)) {
                            @user
                       }
                   </div>
               </td>
               <td data-value="subbed" data-field="status">
                   <div contenteditable="true">
                       @for(user <- content.stateHistory.get(WorkflowStatus.Subbed)) {
                            @user
                       }
                   </div>
               </td>
               <td data-value="published" data-field="status">
                   <div contenteditable="true">
                       @for(user <- content.stateHistory.get(WorkflowStatus.Published)) {
                            @user
                       }
                   </div>
               </td>
               @if(content.lastModification.isDefined) {
                   @for(mod<-content.lastModification){
                   <td>@displayDate(mod.dateTime)</td>
                   <td>@mod.user.getOrElse("unknown")</td>
                   <td>@mod.whatChanged</td>
                   }
               }
               @if(!content.lastModification.isDefined) {
                    <td></td>
                    <td></td>
                    <td></td>
               }
           </tr>
           }
       </table>
   </div>
<script>
    $('[contenteditable]').on('keyup', function (evt) {
        var tdElement = $(this).parents('td');
        var trElement = $(this).parents('tr');
        var content = trElement.attr('data-content');
        var field = tdElement.attr('data-field');
        if(field==='status') {
            var value = tdElement.attr('data-value');
            var user = $(this).text()
        }
        else {
            var value = $(this).text()
        }
        $.post('/fieldChange/' + content + '?field=' + field + '&value=' + value + '&user=' + user).done(function () {
            console.log('done');
        });
        if(evt.keyCode==9) {
            location.reload();
        }
    });

</script>

}
