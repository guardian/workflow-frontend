@(items: List[WorkflowContent], workFlowForm: Form[WorkflowContent])
@import helper._
@import Formatting._
@import models.WorkflowStatus
@main("Content Dashboard") {
   <div class="table">
       <table class="table table-striped">
           <tr>
               <th>Working Title / Path</th>
               <th>Contributors</th>
               <th>Status</th>
               <th>Desk</th>
               <th>Scheduled Launch</th>
               <th>Author</th>
               <th>Edited</th>
               <th>Subbed</th>
               <th>Published</th>
               <th>Last Modified</th>
               <th>By</th>
               <th>What Changed</th>
           </tr>
           @for(content <- items) {
           <tr data-content=@content.id>
               <td>
                   @for(title <- content.workingTitle) {
                   @title
                   }
                   @for(path <- content.path) {
                   @path
                   }
               </td>
               <td>@content.contributors.map(_.name).mkString(", ")</td>
               <td>@content.status</td>
               <td data-field="desk">@content.desk</td>
               <td data-field="launch">
                   <div contenteditable="true">@content.scheduledLaunch.map(displayDate(_))</div>
               </td>
               <td data-value="author" data-field="status">
                   <div contenteditable="true">
                       @for(user <- content.stateHistory.get(WorkflowStatus.Author)) {
                            @user
                       }
                   </div>
               </td>
               <td data-value="edited" data-field="status">
                   <div contenteditable="true">
                       @for(user <- content.stateHistory.get(WorkflowStatus.Edited)) {
                            @user
                       }
                   </div>
               </td>
               <td data-value="subbed" data-field="status">
                   <div contenteditable="true">
                       @for(user <- content.stateHistory.get(WorkflowStatus.Subbed)) {
                            @user
                       }
                   </div>
               </td>
               <td data-value="published" data-field="status">
                   <div contenteditable="true">
                       @for(user <- content.stateHistory.get(WorkflowStatus.Published)) {
                            @user
                       }
                   </div>
               </td>
               @if(content.lastModification.isDefined) {
                   @for(mod<-content.lastModification){
                   <td>@displayDate(mod.dateTime)</td>
                   <td>@mod.user.getOrElse("unknown")</td>
                   <td>@mod.whatChanged</td>
                   }
               }
               @if(!content.lastModification.isDefined) {
                    <td></td>
                    <td></td>
                    <td></td>
               }
           </tr>
           }
       </table>
   </div>
  <div class="form">
    @form(action=routes.Application.newWorkFlow()){
        @inputText(workFlowForm("title"))
        @select(field = workFlowForm("desk"), options = options(List("technology","sport", "g2")))
        @select(field = workFlowForm("status"), options = options(List("created","author","edited", "subbed","published")))
      <input type="submit" value="Create">
    }
  </div>
<script>
    $('[contenteditable]').on('input', function () {
        var tdElement = $(this).parents('td');
        var trElement = $(this).parents('tr');
        var content = trElement.attr('data-content');
        var field = tdElement.attr('data-field');
        if(field==='status') {
            var value = tdElement.attr('data-value');
            var user = $(this).text()
        }
        else {
            var value = $(this).text()
        }
        $.post('/fieldChange/' + content + '?field=' + field + '&value=' + value + '&user=' + user).done(function () {
            console.log('done');
        });
    });

</script>

}
